"use strict";(function(n,t){var i=n,r={classes:{exerciseInstance:"exercise-instance",exerciseSet:"exercise-set",triggerAddExercise:"workout__trigger--add-exercise"},sessionStorageKeys:{addExerciseTriggeringNodeId:"workoutsCreate__add-exercise__triggering-node-id"}};i.init=function(){document.addEventListener("DOMContentLoaded",function(){console.debug("DOM content loaded.");i.validateDependencies();i.bindEvents();i.setWorkoutDateToCurrentDateTime();console.debug("Initialized workoutCreate.")})};i.validateDependencies=function(){if(!1 in document.createElement("template"))throw"This application requires a browser with template support, such as Chrome, to run.";if(typeof Storage=="undefined")throw"This application requires a browser with session storage.";};i.bindEvents=function(){console.debug("Binding events...");i.bindExerciseSelectionModal();i.bindExerciseInstanceAddTrigger();i.bindExerciseInstanceRemoveTrigger();i.bindExerciseSetAddTrigger();i.bindExerciseSetRemoveTrigger();console.debug("Finished binding events.")};i.addExerciseToWorkout=function(n,t,u){console.debug(`Adding exercise with id [${n}], name [${t}], and triggering node id [${u}].`);let f=i.getTemplateContentFor(r.classes.exerciseInstance).querySelector(`.${r.classes.exerciseInstance}`),e=`ExerciseInstances[${i.getExerciseInstanceCount()}]`;i.replaceProperties(f,"#ExerciseId",e,".ExerciseId",["id","name"]);i.replaceProperties(f,"#ExerciseName",e,".ExerciseName",["id","name"]);i.replaceProperties(f,`[name="${e}.ExerciseName"]`,"",t,["value"]);i.replaceProperties(f,`.${r.classes.exerciseInstance}__name`,"",t,["innerHTML"]);let o=i.createUniqueId();i.replaceProperties(f,`[name="${e}.ExerciseId"]`,"",o,["value"]);let s=document.getElementById(u);s.parentNode.insertBefore(f,s);f.id=o;i.addExerciseSetToExercise(o)};i.addExerciseSetToExercise=function(n){console.debug(`Adding set to exercise instance with id [${n}].`);let f=document.getElementById(n),e=f.getElementsByClassName(`${r.classes.exerciseSet}__container`),u=`ExerciseInstances[${i.getExerciseInstanceCount()-1}].ExerciseSets[${e.length}]`,t=i.getTemplateContentFor(`${r.classes.exerciseSet}-instance`);i.replaceProperties(t,`.${r.classes.exerciseSet}__field--repetitions`,u,".Repetitions",["id","name"]);i.replaceProperties(t,`.${r.classes.exerciseSet}__field--weight`,u,".Weight",["id","name"]);let o=t.querySelector(`[data-valmsg-for="Repetitions"]`);o.setAttribute("data-valmsg-for",`${u}.Repetitions`);let s=t.querySelector(`[data-valmsg-for="Weight"]`);s.setAttribute("data-valmsg-for",`${u}.Weight`);f.getElementsByClassName(`${r.classes.exerciseInstance}__${r.classes.exerciseSet}-list`)[0].appendChild(t);i.reparseFormValidation()};i.bindExerciseSelectionModal=function(){console.debug("Binding exercise selection modal.");t(i.getExerciseModal()).on("shown.bs.modal",function(n){var o=t(this),s=t(n.relatedTarget),e,f,u;sessionStorage.setItem(r.sessionStorageKeys.addExerciseTriggeringNodeId,n.relatedTarget.id);e=o.find(".modal-body");f=e.find(".exercise-modal__loading");f.show();u=t(i.getExerciseModalList());u.empty();t.get("/api/exercises",function(n){f.hide();u.empty();n.sort(function(n,t){return(""+n.name).localeCompare(t.name)}).forEach(function(n){u.append(`<a href="#" data-exercise-id="${n.id}" 
                                class="${r.classes.triggerAddExercise} list-group-item list-group-item-action" data-dismiss="modal">
                                ${n.name}
                            </a>`)})})})};i.bindExerciseInstanceAddTrigger=function(){console.debug("Binding exercise add trigger.");i.getExerciseModalList().addEventListener("click",function(n){console.debug("Exercises modal list click.");let t=n.target;t.classList.contains(r.classes.triggerAddExercise)&&i.addExerciseToWorkout(t.dataset.exerciseId,t.innerHTML,sessionStorage.getItem(r.sessionStorageKeys.addExerciseTriggeringNodeId))})};i.bindExerciseInstanceRemoveTrigger=function(){i.getExerciseContainer().addEventListener("click",function(n){console.debug("Exercises container click.");let t=`${r.classes.exerciseInstance}__trigger--remove-${r.classes.exerciseInstance}`;if(n.target.classList.contains(t)||n.target.parentNode.classList.contains(t)){if(console.debug("Exercise instance remove trigger clicked."),n.preventDefault(),!confirm("Are you sure you want to delete this exercise?"))return;let t=`.${r.classes.exerciseInstance}`;console.debug(`Remove exercise set trigger clicked for ${t}.`);n.target.closest(t).remove()}})};i.bindExerciseSetAddTrigger=function(){console.debug("Binding exercise set add trigger.");i.getExerciseContainer().addEventListener("click",function(n){if(console.debug("Exercises container click."),n.target.classList.contains(`${r.classes.exerciseInstance}__trigger--add-${r.classes.exerciseSet}`)){console.debug("Add exercise set trigger click.");n.preventDefault();let t=n.target.closest(`.${r.classes.exerciseInstance}`).id;i.addExerciseSetToExercise(t)}})};i.bindExerciseSetRemoveTrigger=function(){console.debug("Bindinge exercise set remove trigger.");i.getExerciseContainer().addEventListener("click",function(n){console.debug("Exercises container click.");let t=`${r.classes.exerciseSet}__trigger--remove-${r.classes.exerciseSet}`;if(n.target.classList.contains(t)||n.target.parentNode.classList.contains(t)){if(console.debug("Exercise set remove trigger clicked."),n.preventDefault(),!confirm("Are you sure you want to delete this exercise set?"))return;let t=`.${r.classes.exerciseSet}__container`;console.debug(`Remove exercise set trigger clicked for ${t}.`);n.target.closest(t).remove()}})};i.createUniqueId=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,n=>(n^crypto.getRandomValues(new Uint8Array(1))[0]&15>>n/4).toString(16))};i.getExerciseContainer=function(){return document.getElementById("excercise__container")};i.getExerciseInstanceCount=function(){return document.getElementsByClassName(r.classes.exerciseInstance).length};i.getExerciseModal=function(){return document.getElementById("exercise-modal")};i.getExerciseModalList=function(){return i.getExerciseModal().getElementsByClassName("exercise-modal__list")[0]};i.getTemplateContentFor=function(n){let t=`workouts__templates__${n}`;console.debug(`Getting template for [${t}].`);let i=document.getElementById(t);return document.importNode(i.content,!0)};i.reparseFormValidation=function(){let n=t("#workouts-create__form");n.removeData("validator").removeData("unobtrusiveValidation");t.validator.unobtrusive.parse(n);console.debug("Reparsed validation.")};i.replaceProperties=function(n,t,i,r,u){let e=n.querySelector(t),f=i+r;console.debug(`Updating [${t}] properties with value [${f}]...`);u.forEach(function(n){console.debug(`Updating [${t}] property [${n}] with value [${f}]...`);e[n]=f})};i.setWorkoutDateToCurrentDateTime=function(){Date.prototype.toDateTimeInputValue=function(){var n=new Date(this);return n.setMinutes(this.getMinutes()-this.getTimezoneOffset()),n.toJSON()};document.getElementById("CreatedTimestamp").value=(new Date).toDateTimeInputValue().slice(0,-8)}})(window.WorkoutsCreate=window.WorkoutsCreate||{},jQuery);